#!/bin/bash

for i in $(seq 1 50)
do
    echo "evals;expr;nll;coeff;best_nll" > run${i}.csv
    
    # explanation:
    # randomly shuffle all expressions
    # get only the expression (1), nll (2), and parameters (3)
    # calculate the minimum of nll (2) and use online algorithm (streaming -s)
    # output all rows with row numbers (-n)
    # awk: output only the lines where field 5 (min nll) changes (to save space)
    
    mlr --csv --fs ';' --headerless-csv-output \
        --from ../../esr/nikuradse_2_size10/fittingresults_rar_ranked.txt \
        shuffle \
        then cut -f 1,2,3 \
        then stats1 -a min -f 2 -s \
        then cat -n \
        | awk -F ';' '!a[$5]++' \
	>> run${i}.csv
done
